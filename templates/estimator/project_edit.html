<!-- templates/estimator/project_edit.html -->
{% extends "estimator/base_dashboard.html" %}
{% load static %}

{% block page_title %}Edit Project: {{ project.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h3>{{ project.name }} <small class="text-muted">({{ project.uploaded_by }})</small></h3>
    <a href="#" class="btn btn-sm btn-outline-secondary mb-3">History</a>

    <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
        {% csrf_token %}
        <table class="table table-bordered">
            {{ form.as_table }}
        </table>
        <div class="mt-4">
            <button type="submit" class="btn btn-primary">Save Changes</button>
            <a href="{% url 'project_detail' project.pk %}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const start = document.querySelector('#id_start_date');
    const end = document.querySelector('#id_end_date');
    const days = document.querySelector('#id_duration_days');

    function calc() {
        if (start.value && end.value) {
            const diff = (new Date(end.value) - new Date(start.value)) / (1000*60*60*24);
            days.value = Math.round(diff);
        }
    }
    start.addEventListener('change', calc);
    end.addEventListener('change', calc);
    calc();
});
</script>
{% endblock %}