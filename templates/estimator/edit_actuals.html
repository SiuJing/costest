<!-- templates/estimator/edit_actuals.html -->
{% extends "base.html" %}
{% load humanize %}
{% load extra_filters %}  

{% block title %}Edit Actuals - {{ project.name }}{% endblock %}

{% block content %}
<h4>Edit Actual Costs â€“ {{ project.name }}</h4>

<form method="post">
    {% csrf_token %}
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Description</th>
                    <th class="text-end">Est Qty</th>
                    <th class="text-end">Est Rate</th>
                    <th class="text-end">Est Amt</th>
                    <th class="text-end"><strong>Actual Qty</strong></th>
                    <th class="text-end"><strong>Actual Rate</strong></th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                {% with actual=actuals_dict|get_item:item.id %}
                <tr>
                    <td>{{ item.section }}</td>
                    <td>{{ item.description }}</td>
                    <td class="text-end">{{ item.quantity }}</td>
                    <td class="text-end">{{ item.rate|floatformat:2 }}</td>
                    <td class="text-end">{{ item.amount|floatformat:2|intcomma }}</td>
                    <td class="text-end">
                        <input type="number" step="0.001" name="item_{{ item.id }}_qty"
                               class="form-control form-control-sm" style="width:100px"
                               value="{{ actual.quantity_actual|default:'' }}">
                    </td>
                    <td class="text-end">
                        <input type="number" step="0.01" name="item_{{ item.id }}_rate"
                               class="form-control form-control-sm" style="width:100px"
                               value="{{ actual.rate_actual|default:'' }}">
                    </td>
                </tr>
                {% endwith %}
                {% endfor %}
            </tbody>
        </table>
    </div>
    <button type="submit" class="btn btn-primary">Save Actuals</button>
    <a href="{% url 'project_detail' project.pk %}" class="btn btn-secondary">Cancel</a>
</form>
{% endblock %}